<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent-OS Enhanced Dashboard - Phase 2</title>
    <link rel="stylesheet" href="/modern-dashboard/design-system.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Verify Chart.js loading
        window.addEventListener('load', function() {
            console.log('üîç Checking Chart.js loading...');
            
            if (typeof Chart === 'undefined') {
                console.error('‚ùå Chart.js failed to load from CDN');
                // Try alternative CDN
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.5.0/chart.min.js';
                script.onload = function() {
                    console.log('‚úÖ Chart.js loaded from alternative CDN');
                };
                document.head.appendChild(script);
            } else {
                console.log('‚úÖ Chart.js loaded successfully');
            }
        });
    </script>
    <script>
        // Debug script loading
        window.addEventListener('load', function() {
            console.log('Chart.js loaded:', typeof Chart !== 'undefined');
        });
    </script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="dashboard-title">
                        <span class="title-icon">üöÄ</span>
                        Agent-OS Enhanced Dashboard
                        <span class="version-badge">Phase 2</span>
                    </h1>
                    <p class="dashboard-subtitle">Advanced 3D Visualizations & Interactive Analytics</p>
                </div>
                <div class="header-right">
                    <div id="theme-toggle-container"></div>
                    <div class="status-indicator">
                        <span class="status-dot status-online"></span>
                        <span class="status-text">System Online</span>
                    </div>
                    <!-- Quick Actions Menu -->
                    <div class="quick-actions-menu">
                        <button class="quick-action-btn" onclick="uiManager.openGlobalSearch()" title="Search (Ctrl+K)">
                            <span class="action-icon">üîç</span>
                        </button>
                        <button class="quick-action-btn" onclick="uiManager.openQuickActionsModal()" title="Quick Actions (Ctrl+M)">
                            <span class="action-icon">‚ö°</span>
                        </button>
                        <button class="quick-action-btn" onclick="uiManager.showSystemInfo()" title="System Info">
                            <span class="action-icon">‚ÑπÔ∏è</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Chart Grid -->
            <div class="chart-grid">
                <!-- Chart.js Bar Chart Card -->
                <div class="chart-card fade-in">
                    <div class="chart-card-header">
                        <h3 class="chart-card-title">System Performance Metrics</h3>
                        <div class="chart-card-actions">
                            <button class="chart-card-action" onclick="exportChart('bar-chart')">Export</button>
                            <button class="chart-card-action" onclick="updateBarChart()">Update</button>
                        </div>
                    </div>
                    <div class="chart-container" id="bar-chart-container">
                        <canvas id="bar-chart" width="400" height="300"></canvas>
                        <div class="chart-controls" id="bar-chart-controls">
                            <div class="control-group">
                                <label for="bar-chart-type">Chart Type:</label>
                                <select id="bar-chart-type" onchange="changeBarChartType(this.value)">
                                    <option value="bar">Bar Chart</option>
                                    <option value="line">Line Chart</option>
                                    <option value="doughnut">Doughnut Chart</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="bar-animation-speed">Animation Speed:</label>
                                <input type="range" id="bar-animation-speed" min="0.1" max="2" step="0.1" value="1" 
                                       onchange="setAnimationSpeed('bar-chart', this.value)">
                            </div>
                            <div class="control-group">
                                <button class="btn btn-secondary" onclick="resetBarChart()">Reset</button>
                                <button class="btn btn-primary" onclick="exportChart('bar-chart')">Export</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chart.js Line Chart Card -->
                <div class="chart-card fade-in">
                    <div class="chart-card-header">
                        <h3 class="chart-card-title">System Analysis Overview</h3>
                        <div class="chart-card-actions">
                            <button class="chart-card-action" onclick="exportChart('line-chart')">Export</button>
                            <button class="chart-card-action" onclick="updateLineChart()">Update</button>
                        </div>
                    </div>
                    <div class="chart-container" id="line-chart-container">
                        <canvas id="line-chart" width="400" height="300"></canvas>
                        <div class="chart-controls" id="line-chart-controls">
                            <div class="control-group">
                                <label for="line-chart-type">Chart Type:</label>
                                <select id="line-chart-type" onchange="changeLineChartType(this.value)">
                                    <option value="line">Line Chart</option>
                                    <option value="bar">Bar Chart</option>
                                    <option value="scatter">Scatter Chart</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label for="line-animation-speed">Animation Speed:</label>
                                <input type="range" id="line-animation-speed" min="0.1" max="2" step="0.1" value="1" 
                                       onchange="setAnimationSpeed('line-chart', this.value)">
                            </div>
                            <div class="control-group">
                                <button class="btn btn-secondary" onclick="resetLineChart()">Reset</button>
                                <button class="btn btn-primary" onclick="exportChart('line-chart')">Export</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Metrics Card -->
                <div class="chart-card fade-in">
                    <div class="chart-card-header">
                        <h3 class="chart-card-title">Real-time System Health</h3>
                        <div class="chart-card-actions">
                            <button class="chart-card-action" onclick="refreshMetrics()">Refresh</button>
                        </div>
                    </div>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-icon">üñ•Ô∏è</span>
                                <span class="metric-label">CPU Usage</span>
                            </div>
                            <div class="metric-value" id="cpu-usage">75%</div>
                            <div class="metric-progress">
                                <div class="progress-bar" style="width: 75%"></div>
                            </div>
                            <div class="metric-trend trend-stable">Stable</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-icon">üíæ</span>
                                <span class="metric-label">Memory</span>
                            </div>
                            <div class="metric-value" id="memory-usage">68%</div>
                            <div class="metric-progress">
                                <div class="progress-bar" style="width: 68%"></div>
                            </div>
                            <div class="metric-trend trend-increasing">Increasing</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-icon">üåê</span>
                                <span class="metric-label">Network</span>
                            </div>
                            <div class="metric-value" id="network-usage">32%</div>
                            <div class="metric-progress">
                                <div class="progress-bar" style="width: 32%"></div>
                            </div>
                            <div class="metric-trend trend-decreasing">Decreasing</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-header">
                                <span class="metric-icon">üíø</span>
                                <span class="metric-label">Disk I/O</span>
                            </div>
                            <div class="metric-value" id="disk-usage">45%</div>
                            <div class="metric-progress">
                                <div class="progress-bar" style="width: 45%"></div>
                            </div>
                            <div class="metric-trend trend-stable">Stable</div>
                        </div>
                    </div>
                </div>

                <!-- Performance Analytics Card -->
                <div class="chart-card fade-in">
                    <div class="chart-card-header">
                        <h3 class="chart-card-title">Performance Analytics</h3>
                        <div class="chart-card-actions">
                            <button class="chart-card-action" onclick="toggleAnalytics()">Toggle</button>
                        </div>
                    </div>
                    <div class="analytics-grid">
                        <div class="analytics-item">
                            <div class="analytics-label">Response Time</div>
                            <div class="analytics-value" id="response-time">125ms</div>
                            <div class="analytics-target">Target: 200ms</div>
                        </div>
                        <div class="analytics-item">
                            <div class="analytics-label">Throughput</div>
                            <div class="analytics-value" id="throughput">1,500 req/s</div>
                            <div class="analytics-target">Target: 2,000 req/s</div>
                        </div>
                        <div class="analytics-item">
                            <div class="analytics-label">Error Rate</div>
                            <div class="analytics-value" id="error-rate">0.5%</div>
                            <div class="analytics-target">Target: 1.0%</div>
                        </div>
                        <div class="analytics-item">
                            <div class="analytics-label">Availability</div>
                            <div class="analytics-value" id="availability">99.8%</div>
                            <div class="analytics-target">Target: 99.9%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Table Section -->
            <section class="data-table-section">
                <div class="chart-card fade-in">
                    <div class="chart-card-header">
                        <h3 class="chart-card-title">System Events & Logs</h3>
                        <div class="chart-card-actions">
                            <button class="chart-card-action" onclick="refreshDataTable()">Refresh</button>
                            <button class="chart-card-action" onclick="exportDataTable()">Export</button>
                        </div>
                    </div>
                    <div class="data-table-container" id="system-events-table">
                        <!-- Data table will be initialized here -->
                    </div>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="quick-actions">
                <h2 class="section-title">Quick Actions</h2>
                <div class="actions-grid">
                    <button class="action-button" onclick="showSystemInfo()">
                        <span class="action-icon">‚ÑπÔ∏è</span>
                        <span class="action-text">System Info</span>
                    </button>
                    <button class="action-button" onclick="exportDashboard()">
                        <span class="action-icon">üìä</span>
                        <span class="action-text">Export Data</span>
                    </button>
                    <button class="action-button" onclick="showSettings()">
                        <span class="action-icon">‚öôÔ∏è</span>
                        <span class="action-text">Settings</span>
                    </button>
                    <button class="action-button" onclick="showHelp()">
                        <span class="action-icon">‚ùì</span>
                        <span class="action-text">Help</span>
                    </button>
                    <button class="action-button" onclick="showNotifications()">
                        <span class="action-icon">üîî</span>
                        <span class="action-text">Notifications</span>
                    </button>
                    <button class="action-button" onclick="showDataTable()">
                        <span class="action-icon">üìã</span>
                        <span class="action-text">Data Table</span>
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="/modern-dashboard/theme-manager.js"></script>
    <script src="/modern-dashboard/data/sample-datasets.js"></script>
    
    <!-- New UI Components -->
    <script src="/modern-dashboard/js/components/NotificationSystem.js"></script>
    <script src="/modern-dashboard/js/components/ModalSystem.js"></script>
    <script src="/modern-dashboard/js/components/DataTable.js"></script>
    <script src="/modern-dashboard/js/components/UIManager.js"></script>
    
    <script>
        // Global chart instances
        let barChart = null;
        let scatterChart = null;
        let uiManager = null;
        let systemEventsTable = null;
        
        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('üö® Global error caught:', event.error);
            console.error('Error details:', event.error.stack);
        });
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM Content Loaded');
            // Wait longer for CDN libraries to load
            setTimeout(() => {
                initializeDashboard();
            }, 3000);
        });
        
        function initializeDashboard() {
            console.log('üöÄ Initializing dashboard...');
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('‚ùå Chart.js not loaded, retrying in 2 seconds...');
                setTimeout(() => {
                    initializeDashboard();
                }, 2000);
                return;
            }
            
            // Check if Chart.js is available
            if (typeof Chart === 'undefined') {
                console.error('‚ùå Chart.js not loaded');
                return;
            }
            
            // Initialize UI Manager first
            console.log('üéõÔ∏è Initializing UI Manager...');
            uiManager = new AgentOSUIManager();
            
            // Use global theme manager instance
            console.log('üé® Using global theme manager...');
            const themeManager = window.agentOSThemeManager || new AgentOSThemeManager();
            
            // Initialize theme toggle button
            console.log('üîò Initializing theme toggle...');
            themeManager.initThemeToggle();
            
            // Initialize Chart.js charts
            console.log('üìä Initializing Chart.js charts...');
            initializeBarChart();
            initializeLineChart();
            
            // Initialize data table
            console.log('üìã Initializing data table...');
            initializeDataTable();
            
            // Start real-time updates
            console.log('üîÑ Starting real-time updates...');
            startRealTimeUpdates();
            
            // Add event listeners
            console.log('üéß Setting up event listeners...');
            setupEventListeners();
            
            // Show welcome notification
            setTimeout(() => {
                uiManager.showNotification('success', 'Dashboard Ready', 'Agent-OS Enhanced Dashboard is now fully operational!', {
                    duration: 4000
                });
            }, 1000);
            
            console.log('‚úÖ Dashboard initialization complete');
        }
        
        // Chart.js chart instances
        let barChart, lineChart;
        
        function initializeBarChart() {
            const canvas = document.getElementById('bar-chart');
            
            if (!canvas || typeof Chart === 'undefined') {
                console.error('Bar chart canvas or Chart.js not found');
                return;
            }
            
            try {
                console.log('Initializing Chart.js Bar Chart');
                
                const ctx = canvas.getContext('2d');
                barChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['CPU', 'Memory', 'Network', 'Disk', 'Processes'],
                        datasets: [{
                            label: 'System Performance',
                            data: [75, 68, 32, 45, 23],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.8)',
                                'rgba(54, 162, 235, 0.8)',
                                'rgba(255, 205, 86, 0.8)',
                                'rgba(75, 192, 192, 0.8)',
                                'rgba(153, 102, 255, 0.8)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 205, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'System Performance Metrics'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        },
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const index = elements[0].index;
                                const label = barChart.data.labels[index];
                                const value = barChart.data.datasets[0].data[index];
                                uiManager.showNotification('info', 'Bar Selected', `${label} - ${value}%`);
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Chart.js Bar Chart initialized successfully');
                
            } catch (error) {
                console.error('Error initializing bar chart:', error);
            }
        }
        
        function initializeLineChart() {
            const canvas = document.getElementById('line-chart');
            
            if (!canvas || typeof Chart === 'undefined') {
                console.error('Line chart canvas or Chart.js not found');
                return;
            }
            
            try {
                console.log('Initializing Chart.js Line Chart');
                
                const ctx = canvas.getContext('2d');
                lineChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                        datasets: [{
                            label: 'CPU Usage',
                            data: [45, 52, 78, 85, 72, 68],
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            fill: true,
                            tension: 0.4
                        }, {
                            label: 'Memory Usage',
                            data: [60, 65, 72, 78, 75, 70],
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'System Analysis Overview'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        },
                        onClick: (event, elements) => {
                            if (elements.length > 0) {
                                const index = elements[0].index;
                                const label = lineChart.data.labels[index];
                                const datasetIndex = elements[0].datasetIndex;
                                const datasetLabel = lineChart.data.datasets[datasetIndex].label;
                                const value = lineChart.data.datasets[datasetIndex].data[index];
                                uiManager.showNotification('info', 'Point Selected', `${datasetLabel} at ${label} - ${value}%`);
                            }
                        }
                    }
                });
                
                console.log('‚úÖ Chart.js Line Chart initialized successfully');
                
            } catch (error) {
                console.error('Error initializing line chart:', error);
            }
        }
        
        function initializeDataTable() {
            const container = document.getElementById('system-events-table');
            if (!container) {
                console.error('Data table container not found');
                return;
            }
            
            try {
                // Sample system events data
                const systemEventsData = [
                    { id: 1, timestamp: '2024-01-15 10:30:15', level: 'INFO', component: 'Dashboard', message: 'Dashboard initialized successfully', status: 'Active' },
                    { id: 2, timestamp: '2024-01-15 10:29:45', level: 'WARNING', component: 'Memory', message: 'Memory usage approaching threshold', status: 'Warning' },
                    { id: 3, timestamp: '2024-01-15 10:28:30', level: 'ERROR', component: 'Network', message: 'Connection timeout to external service', status: 'Error' },
                    { id: 4, timestamp: '2024-01-15 10:27:15', level: 'INFO', component: 'CPU', message: 'CPU usage normalized', status: 'Active' },
                    { id: 5, timestamp: '2024-01-15 10:26:00', level: 'SUCCESS', component: 'Backup', message: 'System backup completed', status: 'Success' },
                    { id: 6, timestamp: '2024-01-15 10:25:30', level: 'INFO', component: 'Security', message: 'Security scan completed', status: 'Active' },
                    { id: 7, timestamp: '2024-01-15 10:24:45', level: 'WARNING', component: 'Disk', message: 'Disk space running low', status: 'Warning' },
                    { id: 8, timestamp: '2024-01-15 10:23:20', level: 'INFO', component: 'Database', message: 'Database connection established', status: 'Active' }
                ];
                
                systemEventsTable = uiManager.createDataTable('system-events-table', {
                    columns: [
                        { key: 'id', label: 'ID', sortable: true, width: '60px' },
                        { key: 'timestamp', label: 'Timestamp', sortable: true, width: '150px' },
                        { key: 'level', label: 'Level', sortable: true, width: '100px' },
                        { key: 'component', label: 'Component', sortable: true, width: '120px' },
                        { key: 'message', label: 'Message', sortable: false, width: 'auto' },
                        { key: 'status', label: 'Status', sortable: true, width: '100px' }
                    ],
                    data: systemEventsData,
                    pageSize: 5,
                    sortable: true,
                    searchable: true,
                    selectable: true
                });
                
                console.log('‚úÖ Data table initialized successfully');
                
            } catch (error) {
                console.error('Error initializing data table:', error);
                console.error('Error details:', error.stack);
            }
        }
        
        function startRealTimeUpdates() {
            // Update metrics every 5 seconds
            setInterval(() => {
                updateMetrics();
            }, 5000);
            
            // Update data table every 10 seconds
            setInterval(() => {
                updateDataTable();
            }, 10000);
        }
        
        function updateMetrics() {
            // Simulate real-time metric updates
            const metrics = window.AgentOSDatasets?.realtimeMetrics?.systemHealth;
            if (metrics) {
                document.getElementById('cpu-usage').textContent = metrics.cpu.current + '%';
                document.getElementById('memory-usage').textContent = metrics.memory.current + '%';
                document.getElementById('network-usage').textContent = metrics.network.current + '%';
                document.getElementById('disk-usage').textContent = metrics.disk.current + '%';
                
                // Update progress bars
                updateProgressBars();
            }
        }
        
        function updateDataTable() {
            if (systemEventsTable) {
                // Add a new event to the table
                const newEvent = {
                    id: Date.now(),
                    timestamp: new Date().toLocaleString(),
                    level: ['INFO', 'WARNING', 'ERROR', 'SUCCESS'][Math.floor(Math.random() * 4)],
                    component: ['Dashboard', 'Memory', 'Network', 'CPU', 'Security', 'Database'][Math.floor(Math.random() * 6)],
                    message: 'Real-time system event update',
                    status: 'Active'
                };
                
                const currentData = systemEventsTable.getData();
                currentData.unshift(newEvent);
                
                // Keep only last 20 events
                if (currentData.length > 20) {
                    currentData.splice(20);
                }
                
                systemEventsTable.setData(currentData);
            }
        }
        
        function updateProgressBars() {
            const progressBars = document.querySelectorAll('.progress-bar');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                const targetWidth = parseInt(width) + (Math.random() - 0.5) * 10;
                const newWidth = Math.max(0, Math.min(100, targetWidth));
                bar.style.width = newWidth + '%';
            });
        }
        
        function setupEventListeners() {
            // Chart control event listeners
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('chart-card-action')) {
                    event.preventDefault();
                }
            });
        }
        
        // Chart control functions
        function setCameraPreset(chartId, preset) {
            if (chartId === 'bar-chart' && barChart) {
                barChart.setCameraPreset(preset);
            } else if (chartId === 'scatter-chart' && scatterChart) {
                scatterChart.setCameraPreset(preset);
            }
        }
        
        function resetCamera(chartId) {
            if (chartId === 'bar-chart' && barChart) {
                barChart.resetCamera();
            } else if (chartId === 'scatter-chart' && scatterChart) {
                scatterChart.resetCamera();
            }
        }
        
        function exportChart(chartId) {
            if (chartId === 'bar-chart' && barChart) {
                const dataUrl = barChart.exportAsImage();
                const link = document.createElement('a');
                link.download = 'agent-os-bar-chart.png';
                link.href = dataUrl;
                link.click();
                uiManager.showNotification('success', 'Export Complete', 'Bar chart exported successfully');
            } else if (chartId === 'scatter-chart' && scatterChart) {
                const dataUrl = scatterChart.exportAsImage();
                const link = document.createElement('a');
                link.download = 'agent-os-scatter-chart.png';
                link.href = dataUrl;
                link.click();
                uiManager.showNotification('success', 'Export Complete', 'Scatter chart exported successfully');
            }
        }
        
        function setAnimationSpeed(chartId, speed) {
            // This would be implemented in the chart classes
            console.log(`Setting animation speed for ${chartId}: ${speed}`);
        }
        
        function setPointSize(chartId, size) {
            // This would be implemented in the scatter chart
            console.log(`Setting point size for ${chartId}: ${size}`);
        }
        
        // Data table functions
        function refreshDataTable() {
            if (systemEventsTable) {
                systemEventsTable.setLoading(true);
                setTimeout(() => {
                    updateDataTable();
                    systemEventsTable.setLoading(false);
                    uiManager.showNotification('success', 'Data Refreshed', 'System events table updated');
                }, 1000);
            }
        }
        
        function exportDataTable() {
            if (systemEventsTable) {
                const selectedRows = systemEventsTable.getSelectedRows();
                const data = selectedRows.length > 0 ? selectedRows : systemEventsTable.getData();
                
                const csvContent = 'data:text/csv;charset=utf-8,' + 
                    'ID,Timestamp,Level,Component,Message,Status\n' +
                    data.map(row => `${row.id},"${row.timestamp}","${row.level}","${row.component}","${row.message}","${row.status}"`).join('\n');
                
                const link = document.createElement('a');
                link.download = 'system-events.csv';
                link.href = encodeURI(csvContent);
                link.click();
                
                uiManager.showNotification('success', 'Export Complete', `${data.length} events exported to CSV`);
            }
        }
        
        // Chart.js utility functions
        function updateBarChart() {
            if (barChart) {
                const newData = barChart.data.datasets[0].data.map(() => 
                    Math.floor(Math.random() * 100)
                );
                barChart.data.datasets[0].data = newData;
                barChart.update();
                uiManager.showNotification('success', 'Bar Chart Updated', 'Performance metrics refreshed');
            }
        }
        
        function updateLineChart() {
            if (lineChart) {
                const timeLabels = lineChart.data.labels;
                const newTime = new Date().toLocaleTimeString('en-US', { 
                    hour12: false, 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                if (timeLabels.length > 10) {
                    timeLabels.shift();
                    lineChart.data.datasets.forEach(dataset => dataset.data.shift());
                }
                
                timeLabels.push(newTime);
                lineChart.data.datasets[0].data.push(Math.floor(Math.random() * 100));
                lineChart.data.datasets[1].data.push(Math.floor(Math.random() * 100));
                lineChart.update('none');
                uiManager.showNotification('success', 'Line Chart Updated', 'Real-time data updated');
            }
        }
        
        function changeBarChartType(type) {
            if (barChart) {
                barChart.config.type = type;
                barChart.update();
                uiManager.showNotification('info', 'Chart Type Changed', `Switched to ${type} chart`);
            }
        }
        
        function changeLineChartType(type) {
            if (lineChart) {
                lineChart.config.type = type;
                lineChart.update();
                uiManager.showNotification('info', 'Chart Type Changed', `Switched to ${type} chart`);
            }
        }
        
        function resetBarChart() {
            if (barChart) {
                barChart.data.datasets[0].data = [75, 68, 32, 45, 23];
                barChart.update();
                uiManager.showNotification('info', 'Bar Chart Reset', 'Chart data reset to default values');
            }
        }
        
        function resetLineChart() {
            if (lineChart) {
                lineChart.data.labels = ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'];
                lineChart.data.datasets[0].data = [45, 52, 78, 85, 72, 68];
                lineChart.data.datasets[1].data = [60, 65, 72, 78, 75, 70];
                lineChart.update();
                uiManager.showNotification('info', 'Line Chart Reset', 'Chart data reset to default values');
            }
        }
        
        function setAnimationSpeed(chartId, speed) {
            const chart = chartId === 'bar-chart' ? barChart : lineChart;
            if (chart) {
                chart.options.animation.duration = speed * 1000;
                uiManager.showNotification('info', 'Animation Speed Updated', `Speed set to ${speed}x`);
            }
        }
        
        function exportChart(chartId) {
            const chart = chartId === 'bar-chart' ? barChart : lineChart;
            if (chart) {
                const link = document.createElement('a');
                link.download = `${chartId}.png`;
                link.href = chart.toBase64Image();
                link.click();
                uiManager.showNotification('success', 'Chart Exported', `${chartId} exported successfully`);
            }
        }
        
        // Utility functions
        function refreshMetrics() {
            updateMetrics();
            uiManager.showNotification('success', 'Metrics Refreshed', 'System metrics updated');
        }
        
        function toggleAnalytics() {
            const analyticsGrid = document.querySelector('.analytics-grid');
            if (analyticsGrid) {
                analyticsGrid.style.display = analyticsGrid.style.display === 'none' ? 'grid' : 'none';
            }
        }
        
        function showSystemInfo() {
            uiManager.showModal({
                type: 'info',
                title: 'System Information',
                message: 'Agent-OS Enhanced Dashboard v2.0\n\nFeatures:\n‚Ä¢ Chart.js Interactive Charts\n‚Ä¢ Real-time Metrics\n‚Ä¢ Advanced UI Components\n‚Ä¢ Responsive Design\n‚Ä¢ Accessibility Support\n‚Ä¢ Mobile Optimized',
                buttons: [
                    { text: 'Close', type: 'primary' }
                ]
            });
        }
        
        function exportDashboard() {
            uiManager.showNotification('info', 'Export Started', 'Dashboard export in progress...');
            setTimeout(() => {
                uiManager.showNotification('success', 'Export Complete', 'Dashboard data exported successfully');
            }, 2000);
        }
        
        function showSettings() {
            uiManager.showModal({
                type: 'form',
                title: 'Dashboard Settings',
                formConfig: {
                    fields: [
                        { name: 'theme', label: 'Theme', type: 'select', options: ['light', 'dark', 'system'], value: 'dark' },
                        { name: 'refreshInterval', label: 'Refresh Interval (seconds)', type: 'number', value: 5, min: 1, max: 60 },
                        { name: 'animations', label: 'Enable Animations', type: 'checkbox', value: true },
                        { name: 'notifications', label: 'Show Notifications', type: 'checkbox', value: true }
                    ]
                },
                buttons: [
                    { text: 'Save', type: 'primary', action: 'save' },
                    { text: 'Cancel', type: 'secondary', action: 'cancel' }
                ]
            });
        }
        
        function showHelp() {
            uiManager.showModal({
                type: 'info',
                title: 'Dashboard Help',
                message: 'Keyboard Shortcuts:\n‚Ä¢ Ctrl+K: Global Search\n‚Ä¢ Ctrl+T: Toggle Theme\n‚Ä¢ Ctrl+M: Quick Actions\n‚Ä¢ Escape: Close Modals\n\nFeatures:\n‚Ä¢ Interactive Chart.js Charts\n‚Ä¢ Real-time System Monitoring\n‚Ä¢ Advanced Data Tables\n‚Ä¢ Notification System\n‚Ä¢ Modal Dialogs\n‚Ä¢ Mobile Responsive',
                buttons: [
                    { text: 'Got it!', type: 'primary' }
                ]
            });
        }
        
        function showNotifications() {
            uiManager.showTestNotifications();
        }
        
        function showDataTable() {
            uiManager.showModal({
                type: 'custom',
                title: 'System Events Data Table',
                customContent: '<div id="modal-data-table"></div>',
                buttons: [
                    { text: 'Close', type: 'secondary' }
                ]
            });
            
            // Initialize data table in modal
            setTimeout(() => {
                const modalContainer = document.getElementById('modal-data-table');
                if (modalContainer) {
                    uiManager.createDataTable('modal-data-table', {
                        columns: [
                            { key: 'id', label: 'ID', sortable: true },
                            { key: 'timestamp', label: 'Timestamp', sortable: true },
                            { key: 'level', label: 'Level', sortable: true },
                            { key: 'component', label: 'Component', sortable: true },
                            { key: 'message', label: 'Message', sortable: false },
                            { key: 'status', label: 'Status', sortable: true }
                        ],
                        data: systemEventsTable ? systemEventsTable.getData() : [],
                        pageSize: 10,
                        sortable: true,
                        searchable: true
                    });
                }
            }, 100);
        }
    </script>
</body>
</html>

